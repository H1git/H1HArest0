<!doctype html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <title>Flask Todos</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='dark.css') }}">
</head>
<body>
    <h1>{{ list_title }}</h1>

    <form class="list-form" action="{{ url_for('index') }}" method="get">
        <label for="list">Liste</label>
        <select id="list" name="list">
            {% for list_key, list_name in lists.items() %}
            <option value="{{ list_key }}" {% if list_key == list_id %}selected{% endif %}>{{ list_name }}</option>
            {% endfor %}
        </select>
        <button type="submit">Wechseln</button>
    </form>

    <form class="add-form" action="{{ url_for('add_todo') }}" method="post">
        <input type="hidden" name="list" value="{{ list_id }}">
        <input type="text" name="title" placeholder="Neue Aufgabe hinzufuegen" required>
        <select name="state">
            <option value="idle" selected>idle</option>
            <option value="inwork">inwork</option>
        </select>
        <textarea name="comment" placeholder="Bemerkung (optional)"></textarea>
        <button type="submit">Hinzufuegen</button>
    </form>

    {% if todos %}
    {% set open_todos = todos|rejectattr('done')|list %}
    {% set done_todos = todos|selectattr('done')|list %}
    <p class="meta">{{ todos|length }} Aufgabe(n), {{ done_todos|length }} erledigt</p>
    {% if open_todos %}
    <ul>
        {% for todo in open_todos %}
        <li>
            <div class="todo-body">
                <div class="todo-main">
                    <span class="title {% if todo.done %}done{% endif %}">{{ todo.title }}</span>
                    <span class="state state-{{ todo.state }}">{{ todo.state }}</span>
                </div>
                {% if todo.comment %}
                <details class="comment">
                    <summary>Bemerkung</summary>
                    <p>{{ todo.comment }}</p>
                </details>
                {% endif %}
                <details class="edit">
                    <summary>Bearbeiten</summary>
                    <form class="edit-form" action="{{ url_for('update_todo_html', todo_id=todo.id) }}" method="post">
                        <input type="hidden" name="list" value="{{ list_id }}">
                        <input type="text" name="title" value="{{ todo.title }}" required>
                        <select name="state">
                            <option value="idle" {% if todo.state == "idle" %}selected{% endif %}>idle</option>
                            <option value="inwork" {% if todo.state == "inwork" %}selected{% endif %}>inwork</option>
                        </select>
                        <textarea name="comment" placeholder="Bemerkung (optional)">{{ todo.comment }}</textarea>
                        <button type="submit">Speichern</button>
                    </form>
                </details>
            </div>
            <div class="actions">
                <form action="{{ url_for('toggle_todo', todo_id=todo.id) }}" method="post">
                    <input type="hidden" name="list" value="{{ list_id }}">
                    <button type="submit">{% if todo.done %}Reaktivieren{% else %}Erledigt{% endif %}</button>
                </form>
                <form action="{{ url_for('delete_todo', todo_id=todo.id) }}" method="post">
                    <input type="hidden" name="list" value="{{ list_id }}">
                    <button type="submit">Loeschen</button>
                </form>
            </div>
        </li>
        {% endfor %}
    </ul>
    {% endif %}
    {% if done_todos %}
    <div class="donetrue">
        <h2>Erledigt</h2>
        <ul>
            {% for todo in done_todos %}
            <li>
                <div class="todo-body">
                    <div class="todo-main">
                        <span class="title done">{{ todo.title }}</span>
                        <span class="state state-{{ todo.state }}">{{ todo.state }}</span>
                    </div>
                    {% if todo.comment %}
                    <details class="comment">
                        <summary>Bemerkung</summary>
                        <p>{{ todo.comment }}</p>
                    </details>
                    {% endif %}
                    <details class="edit">
                        <summary>Bearbeiten</summary>
                        <form class="edit-form" action="{{ url_for('update_todo_html', todo_id=todo.id) }}" method="post">
                            <input type="hidden" name="list" value="{{ list_id }}">
                            <input type="text" name="title" value="{{ todo.title }}" required>
                            <select name="state">
                                <option value="idle" {% if todo.state == "idle" %}selected{% endif %}>idle</option>
                                <option value="inwork" {% if todo.state == "inwork" %}selected{% endif %}>inwork</option>
                            </select>
                            <textarea name="comment" placeholder="Bemerkung (optional)">{{ todo.comment }}</textarea>
                            <button type="submit">Speichern</button>
                        </form>
                    </details>
                </div>
                <div class="actions">
                    <form action="{{ url_for('toggle_todo', todo_id=todo.id) }}" method="post">
                        <input type="hidden" name="list" value="{{ list_id }}">
                        <button type="submit">Reaktivieren</button>
                    </form>
                    <form action="{{ url_for('delete_todo', todo_id=todo.id) }}" method="post">
                        <input type="hidden" name="list" value="{{ list_id }}">
                        <button type="submit">Loeschen</button>
                    </form>
                </div>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
    {% else %}
    <p>Keine Aufgaben vorhanden. Fuege eine neue Aufgabe hinzu!</p>
    {% endif %}
</body>
</html>
