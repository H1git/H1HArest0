<!doctype html>
<html lang="de">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>H1 Todos</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='dark.css') }}">
</head>

<body>
    <h1>{{ list_title }}</h1>
    <div style="padding: 1px; ">

        <form class="list-form" action="{{ url_for('index') }}" method="get">
            <!-- <label for="list">Liste</label> -->
            <select id="list" name="list" onchange="this.form.submit()" style="margin-left: 75%;width: 150px">
                {% for list_key, list_name in lists.items() %}
                <option value="{{ list_key }}" {% if list_key==list_id %}selected{% endif %}>{{ list_name }}</option>
                {% endfor %}
            </select>
        </form>

        <details class="commentX">
            <summary>Hinzufügen</summary>

            <form class="add-form" action="{{ url_for('add_todo') }}" method="post">
                <input type="hidden" name="list" value="{{ list_id }}">
                <input type="text" name="title" placeholder="Neue Aufgabe hinzufügen" required>
                <select class="statess" name="state">
                    <option value="Leerlauf" selected>Leerlauf</option>
                    <option value="in Arbeit">in Arbeit</option>
                    <option value="geplant">geplant</option>
                </select>

                <!-- <textarea name="comment" placeholder="Bemerkung (optional)"></textarea> -->
                <details class="commentX">
                    <summary>Bemerkung</summary>
                    <textarea name="comment" placeholder="Bemerkung (optional)"></textarea>
                </details>

                <button style="margin-left: auto;" type="submit">Hinzufügen</button>
            </form>
        </details>

        {% if todos %}
        {% set open_todos = todos|rejectattr('done')|list %}
        {% set done_todos = todos|selectattr('done')|list %}
        <p class="meta">{{ todos|length }} Aufgabe(n), {{ done_todos|length }} erledigt</p>
        {% if open_todos %}
        <ul>
            {% for todo in open_todos %}
            <li>
                <div class="todo-body">
                    <div class="todo-main">
                        <span class="state state-{{ todo.state }}">{{ todo.state }}</span>
                        <span class="title {% if todo.done %}done{% endif %}">{{ todo.title }}</span>
                    </div>
                    {% if todo.comment %}
                    <details class="comment">
                        <summary class="eedit">Bemerkung</summary>
                        <p>{{ todo.comment }}</p>
                    </details>
                    {% endif %}
                    <details class="edit">
                        <summary class="eedit">Bearbeiten</summary>
                        <form class="edit-form" action="{{ url_for('update_todo_html', todo_id=todo.id) }}"
                            method="post">
                            <input type="hidden" name="list" value="{{ list_id }}">
                            <input type="text" name="title" value="{{ todo.title }}" required>
                            <select name="state">
                                <option value="Leerlauf" {% if todo.state=="Leerlauf" %}selected{% endif %}>Leerlauf
                                </option>
                                <option value="in Arbeit" {% if todo.state=="in Arbeit" %}selected{% endif %}>in Arbeit
                                </option>
                                <option value="geplant">geplant</option>
                            </select>
                            <textarea name="comment" placeholder="Bemerkung (optional)">{{ todo.comment }}</textarea>
                            <button type="submit">Speichern</button>
                        </form>
                    </details>
                </div>
                <div class="actions">
                    <form action="{{ url_for('toggle_todo', todo_id=todo.id) }}" method="post">
                        <input type="hidden" name="list" value="{{ list_id }}">
                        <button class="xbutton" type="submit">{% if todo.done %}Reaktivieren{% else %}Erledigt{% endif
                            %}</button>
                    </form>
                    <!-- <form action="{{ url_for('delete_todo', todo_id=todo.id) }}" method="post">
                        <input type="hidden" name="list" value="{{ list_id }}">
                        <button class="xbutton" type="submit">Löschen</button>
                    </form> -->
                </div>
            </li>
            {% endfor %}
        </ul>
        {% endif %}

        <details class="commentY">
            <summary>
                <h2>Erledigtes</h2>
            </summary>

            {% if done_todos %}
            <div class="donetrue">
                <ul>
                    {% for todo in done_todos %}
                    <li>
                        <div class="todo-body">
                            <div class="todo-main">
                                <span class="title done">{{ todo.title }}</span>
                                <!-- <span class="state state-{{ todo.state }}">{{ todo.state }}</span> -->
                            </div>
                            <!-- {% if todo.comment %}
                        <details class="comment">
                            <summary class="eedit">Bemerkung</summary>
                            <p style="padding: 5px;">{{ todo.comment }}</p>
                        </details>
                        {% endif %} -->
                            <!-- <details class="edit">
                            <summary class="eedit">Bearbeiten</summary>
                            <form class="edit-form" action="{{ url_for('update_todo_html', todo_id=todo.id) }}"
                                method="post">
                                <input type="hidden" name="list" value="{{ list_id }}">
                                <input type="text" name="title" value="{{ todo.title }}" required>
                                <select name="state">
                                    <option value="Leerlauf" {% if todo.state=="Leerlauf" %}selected{% endif %}>Leerlauf</option>
                                    <option value="in Arbeit" {% if todo.state=="in Arbeit" %}selected{% endif %}>in Arbeit
                                    </option>
                                </select>
                                <textarea name="comment"
                                    placeholder="Bemerkung (optional)">{{ todo.comment }}</textarea>
                                <button type="submit">Speichern</button>
                            </form>
                        </details> -->
                        </div>
                        <div class="actions">
                            <form action="{{ url_for('delete_todo', todo_id=todo.id) }}" method="post">
                                <input type="hidden" name="list" value="{{ list_id }}">
                                <button class="xbutton" style="margin-right: 20px;" type="submit">Löschen</button>
                            </form>
                            <form action="{{ url_for('toggle_todo', todo_id=todo.id) }}" method="post">
                                <input type="hidden" name="list" value="{{ list_id }}">
                                <button class="xxbutton" type="submit">öffnen</button>
                            </form>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </details>
    </div>
    {% endif %}
    {% else %}
    <p>Keine Aufgaben vorhanden. Fuege eine neue Aufgabe hinzu!</p>
    {% endif %}
</body>

</html>
